From 7dd79d087031b89fdf22cc985aa59158df0f9c5b Mon Sep 17 00:00:00 2001
From: AllSpark <allspark@microsoft.com>
Date: Sun, 21 Sep 2025 10:54:11 +0000
Subject: [PATCH] Backport patch: Add EOF check in
 soup_body_output_stream_create_source

---
 libsoup/http1/soup-body-output-stream.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/libsoup/http1/soup-body-output-stream.c b/libsoup/http1/soup-body-output-stream.c
index 3cbd770b..204bb9f3 100644
--- a/libsoup/http1/soup-body-output-stream.c
+++ b/libsoup/http1/soup-body-output-stream.c
@@ -323,6 +323,9 @@ soup_body_output_stream_create_source (GPollableOutputStream *stream,
         SoupBodyOutputStreamPrivate *priv = soup_body_output_stream_get_instance_private (bostream);
 	GSource *base_source, *pollable_source;
 
+tif(priv->eof) {
+	g_source_set_ready_time(base_source, G_SOURCE_TIME_NOW);
+}
 	if (priv->eof)
 		base_source = g_timeout_source_new (0);
 	else
-- 
2.51.0

